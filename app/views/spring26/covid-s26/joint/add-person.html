<!-- Use this page as the index for your project -->

<!-- ADDING CUSTOM CSS - Add your custom CSS or Sass in /app/assets/sass/main.scss -->

<!-- Extends the layout from /views/layout.html -->
{% extends 'layout-covid.html' %}
<!-- 
  In /views/layout.html you can:
    - change the header and footer 
    - add custom CSS and JavaScript
-->

<!-- Set the page title -->
{% block pageTitle %}
Book vaccinations prototype
{% endblock %}

<!-- For adding a breadcrumb -->
<!-- Code examples can be found at https://service-manual.nhs.uk/design-system/components/breadcrumbs -->
{% block beforeContent %}
<a class="nhsuk-back-link" href="javascript:history.back()">Back</a>
{% endblock %}

<!-- For adding a back link -->
<!-- Code examples can be found at https://service-manual.nhs.uk/design-system/components/back-link -->
{% block outerContent %}
{% endblock %}

<!-- For adding page content -->
<!-- Page layout code can be found at https://service-manual.nhs.uk/design-system/styles/layout -->
{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">

      <!-- Change the page title here -->

      <!-- Add your content here -->
      <!-- Styles and components can be found at https://service-manual.nhs.uk/design-system -->


        <form action="addProxyPerson" method="get" class="form">

        <fieldset class="nhsuk-fieldset">
          <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--l">
            <h1 class="nhsuk-heading-l">
                You have added this person to your booking
              </h1>
          </legend>

          <table class="nhsuk-table">
            <thead role="rowgroup" class="nhsuk-table__head">
              <tr role="row">
                <th role="columnheader" class="" scope="col">
                  Name
                </th>
                <th role="columnheader" class="" scope="col">
                    Date of birth
                  </th>
                <th role="columnheader" class="" scope="col">
                    Vaccine type
                  </th>
                </tr>
            </thead>
            <tbody class="nhsuk-table__body">
              <tr role="row" class="nhsuk-table__row">
                <td class="nhsuk-table__cell">{{data['first-name']}} {{data['last-name']}}</td>
                <td class="nhsuk-table__cell "><span id="dob-display"></span></td>
                <td class="nhsuk-table__cell "><span id="vaccine-display-1"></span></td>
              </tr>
            </tbody>
          </table>        
          
                      <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">
                        <h1 class="nhsuk-fieldset__heading">
                Do you want to add another person to your booking?
              </h1>
                      </legend>

          <div class="nhsuk-form-group">
          <div class="nhsuk-radios" data-module="nhsuk-radios">
      
            <div class="nhsuk-radios__item">
              <input class="nhsuk-radios__input" id="nhs-no-radio" name="radioGroup" type="radio" value="yes">
              <label class="nhsuk-label nhsuk-radios__label" for="nhs-no-radio-yes">
                Yes, add another person
              </label>
            </div>
      
            <div class="nhsuk-radios__item">
              <input class="nhsuk-radios__input" id="nhs-no-radio" name="radioGroup" type="radio" value="no">
              <label class="nhsuk-label nhsuk-radios__label" for="nhs-no-radio-no">
                No, continue without adding anyone else
              </label>
            </div>
      
          </div>
          </div>
        </fieldset>
        <button class="nhsuk-button" data-module="nhsuk-button" type="submit">
          Continue
        </button>
    </form>
      
      </div>
      <!-- End of content -->

    </div>
  </div>

  <script>
  // Display stored DOB on page load
  document.getElementById("dob-display").innerText = localStorage.getItem("dob1") || 'Unknown';

</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  function initVaccineChoice(options = {}) {
    const insetId = options.insetId || "co-admin-inset";
    const linkId = options.linkId || "change-to-single";
    const displayIds = options.displayIds || ["vaccine-display-1", "vaccine-display-2"];

    const inset = document.getElementById(insetId);
    const changeLink = document.getElementById(linkId);
    const displaySpans = displayIds.map(id => document.getElementById(id));

    // Retrieve stored vaccine values for both people
    let vaccineChoices = [
      localStorage.getItem("vaccineChoice1"),
      localStorage.getItem("vaccineChoice2")
    ];

    // Default any missing or blank values to "COVID-19"
    vaccineChoices = vaccineChoices.map(choice =>
      !choice || choice.trim() === "" ? "COVID-19" : choice
    );

    // Store defaults if needed
    localStorage.setItem("vaccineChoice1", vaccineChoices[0]);
    localStorage.setItem("vaccineChoice2", vaccineChoices[1]);

    // Determine if inset should be visible (if either includes flu)
    const showInset = vaccineChoices.some(choice => choice.includes("flu"));
    if (inset) inset.style.display = showInset ? "block" : "none";

    // Update displayed vaccine choices
    displaySpans.forEach((span, i) => {
      if (span) span.textContent = vaccineChoices[i];
    });

    // Handle link click â†’ switch both to COVID-19 only
    if (inset && changeLink) {
      changeLink.addEventListener("click", function (e) {
        e.preventDefault();
        vaccineChoices = ["COVID-19", "COVID-19"];
        localStorage.setItem("vaccineChoice1", vaccineChoices[0]);
        localStorage.setItem("vaccineChoice2", vaccineChoices[1]);
        inset.style.display = "none";

        displaySpans.forEach((span, i) => {
          if (span) span.textContent = vaccineChoices[i];
        });
      });
    }
  }

  // Initialize with default IDs
  initVaccineChoice();
});
</script>


{% endblock %}
